import yara
import os
import pandas as pd

columnsNames = ["file_name","rules"] #columns names of the CSV files
watchedDirectory = '/home/ramos/.local/share' #Directory to be scanner
outputPath = "/home/ramos/Escritorio/tocar/YARA/datos/datos.csv" #path of the csv output file
rules = '/home/ramos/Escritorio/tocar/YARA/norma'
def foundMatches(file):
    matches = rules.match(file)
    if len(matches)>0:
        selectedFile = [file, matches]
        df1 = pd.DataFrame([selectedFile], columns = columnsNames)
        if not os.path.isfile(outputPath):
            df1.to_csv(outputPath, index=None, header=True)
        else:
            df1.to_csv(outputPath, index=None, mode='a', header=False)


def foundFiles(dir):
    contenido = os.listdir(dir)
    for fichero in contenido:
        if os.path.isfile(os.path.join(dir, fichero)):
            foundMatches(os.path.join(dir, fichero))
        elif os.path.isdir(os.path.join(dir, fichero)):
            foundFiles(os.path.join(dir, fichero))



#load the compiled rules
rules = yara.load(rules)
#start the scann 
foundFiles(watchedDirectory)

